#SPDX-License-Identifier: MIT-0
---
# tasks file for webserver
- name: create index.html from template
  ansible.builtin.template:
    src: server.j2
    dest: /var/www/html/index.html
    mode: '0644'
  notify: restart apache
  
- name: allow incoming on port 80
  ansible.builtin.ufw:
    rule: allow
    port: '80'
    proto: tcp
    state: enabled
    
- name: start apache
  ansible.builtin.service:
    name: apache2
    state: started
    
- name: autostart
  ansible.builtin.service:
    name: apache2
    enabled: yes
    
- name: availability
  ansible.builtin.uri:
    url: http://{{ ansible_default_ipv4.address }}
    status_code: 200
  register: result
  until: result.status == 200
  retries: 5
  delay: 5
